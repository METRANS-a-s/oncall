services:
  web:
    build: .
    image: oncall
    depends_on: [init]
    ports:
      - "8080:8080"
    environment:
      - DOCKER_DB_BOOTSTRAP=1
      - IRIS_API_HOST=iris
    volumes:
      - ./configs/config.docker.yaml:/app/config.yaml
  
  mysql:
    image: mariadb:12.0.2
    ports:
      - "3306:3306"
    environment:
      MARIADB_ROOT_PASSWORD: 1234
      MARIADB_USER: oncall
      MARIADB_PASSWORD: oncall
      MARIADB_DATABASE: oncall

  init:
    image: oncall
    restart: Never
    entrypoint: [/app/.venv/bin/create-db]
    command: [/app/config.yaml, /app/init.sql]
    depends_on: [mysql]
    volumes:
      - ./configs/config.docker.yaml:/app/config.yaml

